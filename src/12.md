# Pinia ( 資料管理 ) 
- [Pinia官方](https://pinia.vuejs.org/)
- [Pinia中文文檔](https://pinia.web3doc.top/introduction.html)



## 簡介 <div id="pinia-intro"></div>
在Vue3的版，使用簡單的狀態管裡其實用reactive()來創建（這裡就當成store來解釋），所以某個組件有使用到這組store做新增或修改，在有使用到這store的組件，都會一併自動更新，也就是說可以不同組件調用這個store來新增或修改，所有資料都會同步非常彈性，但如果是在的中大型專案，就可能必須要有狀態管理的工具，來規範團隊的協作方式，這時候使用狀態管理的pinia工具( 官方推薦，可當做Vuex5 )
  
- 介紹特點 :
  1. 移除 Mutations，要修改state值，使用Actions來操做 ( 支持同步和非同步 ），省去Mutations改值的方式
  2. 沒有module結構，所以每組store都是獨立的，資料不會有嵌套結構，但也可以用引入其他store方式來使用(隱式嵌套)
  3. 對TypeScript很好的支援
  4. Vue2和Vue3都能使用
  5. 支持使用Pinia套，可自己擴展套件
  6. Vue DevTools 工具，可透過工具修改值，跟蹤出發事件的時間線等
   
## 安裝方式 <div id="pinia-install"></div>
- 如果使用vite啟動vue的專案，在選擇配置上可選是否安裝pinia的選項
```sh
// 此為vite啟動vue的專案
npm init vite@latest
```
- 手動安裝pinia
```sh
npm install pinia
```

## 起手式 <div id="pinia-init"></div>

安裝完pinia後，需要去vue註冊pinia，這樣就能在component內入pinia來使用

<!--sec data-title="起手式 範例 :" data-id="section1" data-show=true ces-->

```js
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'

const app = createApp(App)

app.use(createPinia())

app.mount('#app')
```

<!--endsec-->


## pinia - state <div id="pinia-state"></div>

<!--sec data-title="State 範例 :" data-id="section2" data-show=true ces-->

```js
// stores.js
// 引入 defineStore 方法 
import { defineStore } from 'pinia'

// 第一個參數為store 唯一的id 必須加上
export default defineStore('user',{
  state: () => ({
    name:'test',  
    userList: [1,2,3,4,5,6]
  }),
})
```

```xml
<script setup>
// component.vue
import useStore  from '@/stores/index'
const store = useStore()
</script>

<template>
    <ul>
        <li v-for="user in store.userList" :key="user">{{ user }}</li>
    </ul>
</template>
```

這邊需注意的是useStore回傳的是一個proxy包裹對象( 如vue3 reactive )，使用上不用.value取值，這邊直得注意的事，如果使用解構的方式需使用storeToRefs()方法，重新綁定

```xml
<script setup>
import useStore from '@/stores/index'
import { storeToRefs } from 'pinia'

const store = useStore()
const { userList } = storeToRefs(store)
</script>

<template>
    <ul>
        <li v-for="user in userList" :key="user">{{ user }}</li>
    </ul>
</template>
```

修改狀態的方式( 直接修改 ) - 1 
```xml
<script setup>
import useStore from '@/stores/index'
const store = useStore()

store.name = '測試員‘
console.log(store.name) // 測試員
</script>
```

修改狀態的方式( 使用$patch方法 ) - 2
```xml
<script setup>
import useStore from '@/stores/index'
const store = useStore()

// 可同時修改多個值，甚至可以新增值上去（ 但不建議這麼做，定義在狀態管理的值，通常都事先規劃好才定義在上面，很少會透過程式碼直接新增！ ）
store.$patch({
  name: '測試員1',
  userList: [1, 1, 1, 1, 1],
})
console.log(store)

// patch也可透過函式的方式修改store內容
store.$patch((state) => {
  state.name = '測試員2'
  state.userList = [1, 2, 3, 4, 5]
})
console.log(store)

</script>
```

修改狀態的方式( 使用$state 替換整個store狀態 ) - 3
```xml
<script setup>
import useStore from '@/stores/user.js'
const store = useStore()

// 原資料
console.log(store)

// $state的修改方式與$patch有點相似，同樣都能達到修改新增的功能
store.$state = { name: '測試員3', age: 25, list: [] }
console.log(store)
</script>
```
<!--endsec-->


## pinia - getters <div id="pinia-getters"></div>

在pinia的getters等於計算屬性，與vuex ( getters ) 和vue ( computed )都是屬於計算屬性

<!--sec data-title="Getters 範例 :" data-id="section3" data-show=true ces-->

```js
import { defineStore } from 'pinia'
export default defineStore('user',{
  state: () => ({
    userList: [1,2,3,4,5,6]
  }),
  getters:{
      // 參數接收state裡面的屬性值
      userListLength:(state)=> state.userList.length
  }
})
```

在pinia裡面getters只有一個參數值，如果在程式邏輯需要調用其他的getters可使用this去調用（ 我們可以過this去訪問到這個store的實例 ）

> [!warning]
> 需要注意，如果需要使用this去訪問該store其他的getter，不能使用箭頭函示去定義getter ( 執行後會發生錯誤: Cannot read properties of undefined )

```js
import { defineStore } from 'pinia'
export default defineStore('user',{
  state: () => ({
    userList: [1,2,3,4,5,6]
  }),
  getters:{
      userListLength:(state)=> state.userList.length,
 
      doubleLength() {
        return this.userListLength + 1
      }
  }
})
```

也可以調用其他store資料，只需把它引入

```js
import { defineStore } from 'pinia'
import otherStore from './other'

export default defineStore('user',{
  state: () => ({
    userList: [1,2,3,4,5,6]
  }),
  getters:{ 
      otherGetter(state) {
        const otherStore = otherStore()
        return state.userList + otherStore.userList
      }
  }
})
```

<!--endsec-->


## pinia - actions  <div id="pinia-actions"></div>

actions可當做vue組件裡面的method可以做非同步與飛同步的操作，在pinia少了mutations的步驟，統一都使用actions來做傳值，
而在actions裡面的函示，可以調用 "this" 來改動state值 或取getters的值！

<!--sec data-title="Actions 範例 :" data-id="section4" data-show=true ces-->

從組件調用

```js
// store
export default defineStore({
  id: 'user',
  state: () => ({
    name: 'test',
  }),
  actions: {
    updateName(name) {
      this.name = name
    },
  },
})
```


```xml

<script setup>
import userStore from '@/stores/user.js'
const store = userStore()

// 調用 store actions 來修改 
store.updateName('updated test')
</script>

<template>
  <p>store值：{{ store.name }}</p>
</template>

```

<!--endsec-->
