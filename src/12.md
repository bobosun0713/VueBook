# Pinia ( 資料管理 ) 
- [Pinia官方](https://pinia.vuejs.org/)
- [Pinia中文文檔](https://pinia.web3doc.top/introduction.html)


## 安裝方式
- 如果使用vite啟動vue的專案，在選擇配置上已有是否安裝pinia的選項！
```sh
// 此為vite啟動vue的專案
npm init vite@latest
```
- 手動安裝pinia
```sh
npm install pinia
```

## 起手式 <div id="pinia-init"></div>

安裝完pinia後，需要去vue註冊pinia，這樣就能在component內入pinia來使用

<!--sec data-title="起手式 範例 :" data-id="section1" data-show=true ces-->

```js
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'

const app = createApp(App)

app.use(createPinia())

app.mount('#app')
```

<!--endsec-->


## pinia - state <div id="pinia-state"></div>

<!--sec data-title="State 範例 :" data-id="section2" data-show=true ces-->

```js
// stores.js
// 引入 defineStore 方法 
import { defineStore } from 'pinia'

// 第一個參數為store 唯一的id 必須加上
export default defineStore('user',{
  state: () => ({
    name:'test',  
    userList: [1,2,3,4,5,6]
  }),
})
```

```xml
<script setup>
// component.vue
import useStore  from '@/stores/index'
const store = useStore()
</script>

<template>
    <ul>
        <li v-for="user in store.userList" :key="user">{{ user }}</li>
    </ul>
</template>
```

這邊需注意的是useStore回傳的是一個proxy包裹對象( 如vue3 reactive )，使用上不用.value取值，這邊直得注意的事，如果使用解構的方式需使用storeToRefs()方法，重新綁定

```xml
<script setup>
import useStore from '@/stores/index'
import { storeToRefs } from 'pinia'

const store = useStore()
const { userList } = storeToRefs(store)
</script>

<template>
    <ul>
        <li v-for="user in userList" :key="user">{{ user }}</li>
    </ul>
</template>
```

修改狀態的方式( 直接修改 ) - 1 
```xml
<script setup>
import useStore from '@/stores/index'
const store = useStore()

store.name = '測試員‘
console.log(store.name) // 測試員
</script>
```

修改狀態的方式( 使用$patch方法 ) - 2
```xml
<script setup>
import useStore from '@/stores/index'
const store = useStore()

// 可同時修改多個值，甚至可以新增值上去（ 但不建議這麼做，定義在狀態管理的值，通常都事先規劃好才定義在上面，很少會透過程式碼直接新增！ ）
store.$patch({
  name: '測試員1',
  userList: [1, 1, 1, 1, 1],
})
console.log(store)

// patch也可透過函式的方式修改store內容
store.$patch((state) => {
  state.name = '測試員2'
  state.userList = [1, 2, 3, 4, 5]
})
console.log(store)

</script>
```

修改狀態的方式( 使用$state 替換整個store狀態 ) - 3
```xml
<script setup>
import useStore from '@/stores/user.js'
const store = useStore()

// 原資料
console.log(store)

// $state的修改方式與$patch有點相似，同樣都能達到修改新增的功能
store.$state = { name: '測試員3', age: 25, list: [] }
console.log(store)
</script>
```
<!--endsec-->


## pinia - getters

在pinia的getters等於計算屬性，與vuex ( getters ) 和vue ( computed )都是屬於計算屬性

<!--sec data-title="Getters 範例 :" data-id="section3" data-show=true ces-->

```js
import { defineStore } from 'pinia'
export default defineStore('user',{
  state: () => ({
    userList: [1,2,3,4,5,6]
  }),
  getters:{
      // 參數接收state裡面的屬性值
      userListLength:(state)=> state.userList.length
  }
})
```

在pinia裡面getters只有一個參數值，如果在程式邏輯需要調用其他的getters可使用this去調用（ 我們可以過this去訪問到這個store的實例 ）

> [!warning]
> 需要注意，如果需要使用this去訪問該store其他的getter，不能使用箭頭函示去定義getter ( 執行後會發生錯誤: Cannot read properties of undefined )

```js
import { defineStore } from 'pinia'
export default defineStore('user',{
  state: () => ({
    userList: [1,2,3,4,5,6]
  }),
  getters:{
      userListLength:(state)=> state.userList.length,
 
      doubleLength() {
        return this.userListLength + 1
      }
  }
})
```

<!--endsec-->
