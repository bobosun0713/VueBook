# Directive 自訂指令

在 Vue3 的 directive 中，針對裡面的語法做些調整及新增一些語法

- Vue3 : 名稱的改動就如組件的生命週期鉤子函式很像（directive 叫指令鉤子），變得更語意話了

| Vue3          | 說明                                         |
| ------------- | -------------------------------------------- |
| created       | 绑定元素的 attribute 之前調用                |
| beforeMount   | 在元素被插入到 DOM 前调用                    |
| mounted       | 綁定的父組件及所有子節點都掛載完成時調用     |
| beforeUpdate  | 更新綁定的父組件及所有子節點都掛載完成時調用 |
| beforeUnmount | 解除綁定前調用                               |
| unmounted     | 解除綁定後調用                               |

<!--sec data-title="Vue3 範例 : 註冊方式可以用全域註冊 or 區域註冊 ，這邊的註冊方式與 Vue2 步驟相同，差別在於全域註冊的語法稍微改變" data-id="section1" data-show=true ces-->

```js
// 全域註冊
const { createApp } from 'vue'
const app = createApp({})
app.directive('test',{....})


// 區域註冊
const test =  { mounted(){} }
export default {
  directives: {
    // 在模板使用時v-test
    test
  }
}
```

<!--endsec-->

<!--sec data-title="指令鉤子參數 :" data-id="section2" data-show=true ces-->

el、binding、vnode、prevNode 四個參數，但 <span style="color:red;">prevNode</span>參數，只有在 beforeUpdate、updated 才能使用 [參數的詳細資訊](https://staging-cn.vuejs.org/guide/reusability/custom-directives.html#directive-hooks)
```js
const test = {
  created(el, binding, vnode) {
  },
  beforeMount(el, binding, vnode) {
  },
  mounted(el, binding, vnode) {
  },
  beforeUpdate(el, binding, vnode, prevNode) {
  },
  updated(el, binding, vnode, prevNode) {
  },
  beforeUnmount(el, binding, vnode) {
  },
  unmounted(el, binding, vnode) {
  },
};
```

<!--endsec-->


<!--sec data-title="directive 函式簡寫 : 大部分在開發時都很長關注於 mounted 和 updated 的行為才做觸發" data-id="section3" data-show=true ces-->

```js
// 函式簡寫(全域)
app.directive('test', (el, binding) => {
  // 在這邊只會在mounted、updated時才掉用
})

// 函式簡寫(區域): 建議用物件寫法，避免重構邏輯時，需要大改寫法
const test = (el, binding) => {
  // ...
};
```

<!--endsec-->


- Vue2 : 以下為 Vue2.x 的語法名稱，可以與 Vue3 做對比

| Vue2.x           | 說明                                                    |
| ---------------- | ------------------------------------------------------- |
| bind             | 初始化，綁定到元素時調用 property (el , binding, vnode) |
| inserted         | 當綁定元素插入父子層時調用                              |
| update           | 該組件的 VNode 更新時調用                               |
| componentUpdated | 組件的 VNode 及子組件 VNode 全都更新後調用              |
| unbind           | 解除綁定後調用（只調用一次)                             |
